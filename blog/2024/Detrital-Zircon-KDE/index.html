<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Python Template for Plotting Kernel Density Estimates (KDE) of Detrital Zircon U-Pb Data | ZJ Gao's Research Site </title> <meta name="author" content="ZJ Gao"> <meta name="description" content="Interactive bar available to best present your data"> <meta name="keywords" content="Zijie Gao, ZJ Gao, Zijie Gao Geology, ZJ Gao Geology, Zijie Gao website, ZJ Gao website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/logo.png?7440cba5cbcde77b5027ac8e9d6eb074"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://zj-gao.github.io/blog/2024/Detrital-Zircon-KDE/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">ZJ</span> Gao </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/"> </a> </li> <li class="nav-item "> <a class="nav-link" href="/CV/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/Teaching/">Teaching </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <style>@media(max-width:768px){.profile-img-container{float:none!important;text-align:center!important;margin-left:0!important}}</style> <div class="post"> <header class="post-header"> <h1 class="post-title">Python Template for Plotting Kernel Density Estimates (KDE) of Detrital Zircon U-Pb Data</h1> <p class="post-description">Interactive bar available to best present your data</p> </header> <article> <h1 id="motivation">Motivation</h1> <p>Being part of a group well-known for applying U-Pb dating on detrital zircons to study sediment routing, my research methods are typically expected to focus on core description, statistical analysis, and luminescence dating. Initially, I assumed that U-Pb data wouldn’t be a major part of my work, as the samples are either from the Ganges or Brahmaputra rivers. However, when examining super sandy, thick sediment gravity flow deposits (most of which are turbidites), the lithofacies of these deposits surprisingly resemble features typical of the Brahmaputra.</p> <p>This resemblance raises an interesting hypothesis: Could triggering events have occurred upstream in the Brahmaputra River, under favorable external conditions (such as climate-controlled low sea levels), to produce what we now observe as megaturbidites at the distal edge of the Bengal Fan, where our core samples were collected?</p> <h2 id="developing-a-python-based-kde-plotting-tool">Developing a Python-Based KDE Plotting Tool</h2> <p>While there are great tools available for sedimentology data analysis, they are largely based on MATLAB or R. Although I have some familiarity with MATLAB, Python remains my tool of choice. To avoid switching programming environments, I decided to create my own Kernel Density Estimation (KDE) plotting functions in Python. I wanted these plots to meet publication standards, so I used visualization styles from my advisor Mike Blum’s 2018 paper as a reference. <em>(See the paper <a href="https://www.nature.com/articles/s41598-018-25819-5" rel="external nofollow noopener" target="_blank">here</a>).</em> The sample data I’m displaying here is also from that paper, but we’re in the process of collecting new data for future publications!</p> <h2 id="setting-up-the-data">Setting Up the Data</h2> <p>To get started, you’ll need an Excel workbook for your data. If you plan to plot data from multiple sampling sites, arrange the age data from each site in a separate column, with each column named after the sampling site.</p> <h2 id="building-a-basic-plot">Building a Basic Plot</h2> <p>We’ll start with a very simple plot. Initially, I set the bandwidth hyperparameter to 0.01. This creates a trend that appears somewhat bumpy, so I added a smoothing function to improve the visual appeal. The goal is to use the script below to experiment with both the bandwidth and smoothing factors, finding an optimal balance. Decreasing the bandwidth provides more detail, but can result in a bumpy appearance, where smoothing can help make the plot more visually pleasing while retaining the key features of the data.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/KDE/crude_plot-480.webp 480w,/assets/img/posts/KDE/crude_plot-800.webp 800w,/assets/img/posts/KDE/crude_plot-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/KDE/crude_plot.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Below is a sample script to begin working with and the image is a preview of how the interface looks like. Feel free to adjust the parameters as needed:</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/KDE/interactive_plot-480.webp 480w,/assets/img/posts/KDE/interactive_plot-800.webp 800w,/assets/img/posts/KDE/interactive_plot-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/KDE/interactive_plot.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="n">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>
<span class="kn">from</span> <span class="n">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter1d</span>
<span class="kn">from</span> <span class="n">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">widgets</span>

<span class="k">def</span> <span class="nf">plot_kde</span><span class="p">(</span><span class="n">data_sample</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="c1"># Generate KDE
</span>    <span class="n">kde</span> <span class="o">=</span> <span class="nf">gaussian_kde</span><span class="p">(</span><span class="n">data_sample</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">y_values</span> <span class="o">=</span> <span class="nf">kde</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span>
    
    <span class="c1"># Apply smoothing filter
</span>    <span class="n">y_smooth</span> <span class="o">=</span> <span class="nf">gaussian_filter1d</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
    
    <span class="c1"># Plotting
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">))</span>

    <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_smooth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Age (Ma)</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Normalized KDE</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Set x-axis limits and major ticks
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">xticks</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3501</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>  <span class="c1"># Major ticks every 500
</span>    
    <span class="c1"># Add minor ticks every 100
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">().</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_minor_locator</span><span class="p">(</span><span class="n">plt</span><span class="p">.</span><span class="nc">MultipleLocator</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
    
    <span class="c1"># Customize minor tick appearance
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="sh">'</span><span class="s">minor</span><span class="sh">'</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># Remove y-axis ticks
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">().</span><span class="n">yaxis</span><span class="p">.</span><span class="nf">set_ticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">().</span><span class="n">yaxis</span><span class="p">.</span><span class="nf">set_ticklabels</span><span class="p">([])</span>

    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Create interactive sliders for bandwidth and sigma, and add data_sample as a fixed argument
</span><span class="k">def</span> <span class="nf">interactive_plot</span><span class="p">(</span><span class="n">data_sample</span><span class="p">):</span>
    <span class="nf">interact</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nf">plot_kde</span><span class="p">(</span><span class="n">data_sample</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">),</span>
        <span class="n">bandwidth</span><span class="o">=</span><span class="n">widgets</span><span class="p">.</span><span class="nc">FloatSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.008</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> 
                                      <span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">Bandwidth</span><span class="sh">'</span><span class="p">,</span> <span class="n">readout_format</span><span class="o">=</span><span class="sh">'</span><span class="s">.3f</span><span class="sh">'</span><span class="p">),</span>
        <span class="n">sigma</span><span class="o">=</span><span class="n">widgets</span><span class="p">.</span><span class="nc">FloatSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">Smooth</span><span class="sh">'</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></div> <h1 id="stacked-kde-plots-of-multiple-samples">Stacked KDE Plots of Multiple Samples</h1> <h2 id="simple-stack">Simple Stack</h2> <p>When plotting stacked KDEs of multiple samples, the script will automatically use the column names and sample sizes as labels for each plot. The stacking order follows the sequence of columns in the Excel file, meaning the first column will be plotted at the bottom.</p> <p>The <code class="language-plaintext highlighter-rouge">para_dict</code> is a dictionary where each key corresponds to a sample name, and the values are: 1) the age data, 2) the bandwidth parameter, and 3) the smoothing factor. After experimenting with one sample to determine a comfortable combination of bandwidth and smoothing factor, I found that my samples could share the same values, so I set a <code class="language-plaintext highlighter-rouge">default_bandwidth</code> and <code class="language-plaintext highlighter-rouge">default_smooth_factor</code> based on this. For cases where samples may require different settings, I recommend updating the <code class="language-plaintext highlighter-rouge">para_dict</code> accordingly to fine-tune each sample’s parameters.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sh">"""</span><span class="s">
    Import Data with defaulted bandwidth and smooth factor
</span><span class="sh">"""</span>
<span class="c1"># Load the Excel file
</span><span class="n">excel_path</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Blum_2018_Bengal_Fan.xlsx</span><span class="sh">"</span>  <span class="c1"># Replace with the actual path to your file and put it under the same directory of the script
</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_excel</span><span class="p">(</span><span class="n">excel_path</span><span class="p">)</span>

<span class="c1"># Default values for bandwidth and smooth factor
</span><span class="n">default_bandwidth</span> <span class="o">=</span> <span class="mf">0.008</span>
<span class="n">default_smooth_factor</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Initialize the param_dict
</span><span class="n">param_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Process each column to construct the dictionary with column name and valid data count
</span><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">data</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="c1"># Count the number of non-NaN values in the column
</span>    <span class="n">valid_data_count</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="nf">count</span><span class="p">()</span>
    <span class="c1"># Construct the key with column name and valid data count
</span>    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s"> (n=</span><span class="si">{</span><span class="n">valid_data_count</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span>
    <span class="c1"># Assign the column data to the dictionary, excluding NaN values, along with default parameters
</span>    <span class="n">param_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="nf">dropna</span><span class="p">().</span><span class="n">values</span><span class="p">,</span> <span class="n">default_bandwidth</span><span class="p">,</span> <span class="n">default_smooth_factor</span><span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="n">param_dict</span><span class="p">.</span><span class="nf">keys</span><span class="p">())</span>
</code></pre></div></div> <p>Define the visualization function</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>
<span class="kn">from</span> <span class="n">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter1d</span>

<span class="k">def</span> <span class="nf">plot_stacked_kdes</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">color_blocks</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1"># Create figure
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Add color blocks if provided
</span>    <span class="k">if</span> <span class="n">color_blocks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">color_blocks</span><span class="p">:</span>
            <span class="n">plt</span><span class="p">.</span><span class="nf">axvspan</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>  <span class="c1"># Alpha for transparency
</span>
    <span class="c1"># Loop through each dataset and plot
</span>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">smooth_factor</span><span class="p">))</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">items</span><span class="p">()):</span>
        <span class="c1"># Clean data by removing NaNs and infinities
</span>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="p">.</span><span class="nf">isnan</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span>

        <span class="c1"># Generate KDE
</span>        <span class="n">kde</span> <span class="o">=</span> <span class="nf">gaussian_kde</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># x-axis range and resolution
</span>        <span class="n">y_values</span> <span class="o">=</span> <span class="nf">kde</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span>

        <span class="c1"># Apply smoothing filter
</span>        <span class="n">y_smooth</span> <span class="o">=</span> <span class="nf">gaussian_filter1d</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">smooth_factor</span><span class="p">)</span>

        <span class="c1"># Normalize each curve to have a maximum height of 1
</span>        <span class="n">y_smooth</span> <span class="o">=</span> <span class="n">y_smooth</span> <span class="o">/</span> <span class="nf">max</span><span class="p">(</span><span class="n">y_smooth</span><span class="p">)</span>

        <span class="c1"># Offset the y-values to separate curves
</span>        <span class="n">y_offset</span> <span class="o">=</span> <span class="n">y_smooth</span> <span class="o">+</span> <span class="n">idx</span> <span class="o">*</span> <span class="n">offset</span>

        <span class="c1"># Plot the smoothed KDE with black color and line width of 1
</span>        <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Add text label aligned to the right end of the plot, slightly above the curve
</span>        <span class="n">plt</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="mi">3500</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">offset</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> 
                 <span class="n">ha</span><span class="o">=</span><span class="sh">'</span><span class="s">right</span><span class="sh">'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="sh">'</span><span class="s">center</span><span class="sh">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Customize the x-axis
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Age (Ma)</span><span class="sh">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    
    <span class="c1"># Add major ticks every 500 and minor ticks every 100 on the x-axis
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">xticks</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3501</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>  <span class="c1"># Major ticks every 500
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">().</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_minor_locator</span><span class="p">(</span><span class="n">plt</span><span class="p">.</span><span class="nc">MultipleLocator</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>

    <span class="c1"># Thicken x-axis spine and customize x-axis tick appearance
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">().</span><span class="n">spines</span><span class="p">[</span><span class="sh">'</span><span class="s">bottom</span><span class="sh">'</span><span class="p">].</span><span class="nf">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>  <span class="c1"># Thicker x-axis spine
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">().</span><span class="nf">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Thicker x-axis major ticks and labels
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="sh">'</span><span class="s">minor</span><span class="sh">'</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>  <span class="c1"># Thicker minor ticks
</span>
    <span class="c1"># Remove y-axis ticks and labels for a clean stacked look
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">().</span><span class="n">yaxis</span><span class="p">.</span><span class="nf">set_ticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">().</span><span class="n">yaxis</span><span class="p">.</span><span class="nf">set_ticklabels</span><span class="p">([])</span>

    <span class="c1"># Remove only the top and right spines, keep the bottom (x-axis) spine
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">().</span><span class="n">spines</span><span class="p">[</span><span class="sh">'</span><span class="s">top</span><span class="sh">'</span><span class="p">].</span><span class="nf">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">().</span><span class="n">spines</span><span class="p">[</span><span class="sh">'</span><span class="s">right</span><span class="sh">'</span><span class="p">].</span><span class="nf">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">().</span><span class="n">spines</span><span class="p">[</span><span class="sh">'</span><span class="s">left</span><span class="sh">'</span><span class="p">].</span><span class="nf">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

</code></pre></div></div> <p>Run the following command to generate a simple stack graph. <code class="language-plaintext highlighter-rouge">offset</code> defines the vertical distance between each KDE plot.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_stacked_kdes</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color_blocks</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/KDE/plain%20stack-480.webp 480w,/assets/img/posts/KDE/plain%20stack-800.webp 800w,/assets/img/posts/KDE/plain%20stack-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/KDE/plain%20stack.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="stacked-plot-with-densely-populated-age-groups-noted-in-different-colors">Stacked Plot with densely populated age groups noted in different colors</h2> <p>These are preliminary age groups in the Bengal Fan dataset, observed visually (and therefore approximate), to create a demo visualization. Accurate ages, supported by literature, will be included in future updates.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">color_blocks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="p">(</span><span class="mi">173</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">217</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">152</span><span class="o">/</span><span class="mi">255</span><span class="p">)),</span>   <span class="c1"># Greenish block (A)
</span>    <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="p">(</span><span class="mi">140</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">200</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">225</span><span class="o">/</span><span class="mi">255</span><span class="p">)),</span> <span class="c1"># Light Blue block (B)
</span>    <span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="p">(</span><span class="mi">158</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">185</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">225</span><span class="o">/</span><span class="mi">255</span><span class="p">)),</span> <span class="c1"># Blue block (C)
</span>    <span class="p">(</span><span class="mi">910</span><span class="p">,</span> <span class="mi">1250</span><span class="p">,</span> <span class="p">(</span><span class="mi">245</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">220</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">200</span><span class="o">/</span><span class="mi">255</span><span class="p">)),</span> <span class="c1"># Adjusted Light Orange block (D)
</span>    <span class="p">(</span><span class="mi">1300</span><span class="p">,</span> <span class="mi">1700</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">205</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">185</span><span class="o">/</span><span class="mi">255</span><span class="p">)),</span> <span class="c1"># Adjusted Light Pink block (E)
</span>    <span class="p">(</span><span class="mi">1710</span><span class="p">,</span> <span class="mi">2100</span><span class="p">,</span> <span class="p">(</span><span class="mi">245</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">190</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">150</span><span class="o">/</span><span class="mi">255</span><span class="p">)),</span> <span class="c1"># Orange block (F)
</span>    <span class="p">(</span><span class="mi">2300</span><span class="p">,</span> <span class="mi">2750</span><span class="p">,</span> <span class="p">(</span><span class="mi">235</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">140</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">135</span><span class="o">/</span><span class="mi">255</span><span class="p">))</span>  <span class="c1"># Red block (G)
</span><span class="p">]</span>
</code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/KDE/Color_Block_Notation-480.webp 480w,/assets/img/posts/KDE/Color_Block_Notation-800.webp 800w,/assets/img/posts/KDE/Color_Block_Notation-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/KDE/Color_Block_Notation.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_stacked_kdes</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color_blocks</span><span class="o">=</span><span class="n">color_blocks</span><span class="p">)</span>
</code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/KDE/color%20stack-480.webp 480w,/assets/img/posts/KDE/color%20stack-800.webp 800w,/assets/img/posts/KDE/color%20stack-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/KDE/color%20stack.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Here’s the link to the script you can run in Jupyter Notebook: <a href="https://github.com/ZJ-Gao/Detrital_Zircon_KDE_Plot/blob/main/KDE.ipynb" rel="external nofollow noopener" target="_blank">KDE Plot Script on GitHub</a>.</p> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 ZJ Gao. Hosted by Github Pages. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-",title:"",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-cv",title:"CV",description:"",section:"Navigation",handler:()=>{window.location.href="/CV/"}},{id:"nav-projects",title:"Projects",description:"",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-blog",title:"Blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-publications",title:"Publications",description:"",section:"Navigation",handler:()=>{window.location.href="/publications/"}},{id:"nav-teaching",title:"Teaching",description:"",section:"Navigation",handler:()=>{window.location.href="/Teaching/"}},{id:"post-streamlining-academic-workflows-integrating-zotero-with-notion",title:'Streamlining Academic Workflows: Integrating Zotero with Notion <svg width="1.2rem" height="1.2rem" top=".5rem" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M17 13.5v6H5v-12h6m3-3h6v6m0-6-9 9" class="icon_svg-stroke" stroke="#999" stroke-width="1.5" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg>',description:"",section:"Posts",handler:()=>{window.open("https://outstanding-butter-09e.notion.site","_blank")}},{id:"post-python-template-for-plotting-kernel-density-estimates-kde-of-detrital-zircon-u-pb-data",title:"Python Template for Plotting Kernel Density Estimates (KDE) of Detrital Zircon U-Pb Data...",description:"Interactive bar available to best present your data",section:"Posts",handler:()=>{window.location.href="/blog/2024/Detrital-Zircon-KDE/"}},{id:"post-semi-automated-elemental-data-extraction-from-edx-reports-using-python-and-chatgpt",title:"Semi-Automated Elemental Data Extraction from EDX Reports Using Python and ChatGPT",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/XRD/"}},{id:"post-how-to-use-statistical-knowledge-when-analyzing-geological-data",title:"How to use statistical knowledge when analyzing geological data?",description:"Bridging the Gap Between Statistics and Geological Data(:) A Little Case Using Histogram. Will update with data and graphs once published!",section:"Posts",handler:()=>{window.location.href="/blog/2024/MLE/"}},{id:"news-announcement-5",title:"Announcement_5",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_5/"}},{id:"news-announcement-3",title:"Announcement_3",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_3/"}},{id:"news-announcement-2",title:"Announcement_2",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_2/"}},{id:"news-announcement-4",title:"Announcement_4",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_4/"}},{id:"news-announcement-1",title:"Announcement_1",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_1/"}},{id:"news-announcement-6",title:"Announcement_6",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_6/"}},{id:"news-announcement-7",title:"Announcement_7",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_7/"}},{id:"news-announcement-8",title:"Announcement_8",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_8/"}},{id:"projects-bengal-fan",title:"Bengal Fan",description:"from the hignest mountain to the deep sea",section:"Projects",handler:()=>{window.location.href="/projects/1_project/"}},{id:"projects-sem-image-segmentation-with-deep-learning-techniques",title:"SEM Image Segmentation with Deep Learning Techniques",description:"general pipeline for grain-based segmentation",section:"Projects",handler:()=>{window.location.href="/projects/2_project/"}},{id:"projects-investigating-the-fate-of-mg-bearing-calcium-carbonates-during-early-diagenesis",title:"Investigating the Fate of Mg-bearing Calcium Carbonates During Early Diagenesis",description:"",section:"Projects",handler:()=>{window.location.href="/projects/3_project/"}},{id:"projects-project-5",title:"project 5",description:"a project with a background image",section:"Projects",handler:()=>{window.location.href="/projects/5_project/"}},{id:"projects-project-7",title:"project 7",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/7_project/"}},{id:"projects-project-8",title:"project 8",description:"an other project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/8_project/"}},{id:"projects-project-9",title:"project 9",description:"another project with an image \ud83c\udf89",section:"Projects",handler:()=>{window.location.href="/projects/9_project/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%7A%67%61%6F@%6B%75.%65%64%75","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=D8HTOxUAAAAJ","_blank")}},{id:"socials-researchgate",title:"ResearchGate",section:"Socials",handler:()=>{window.open("https://www.researchgate.net/profile/Zijie-Gao/","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/ZJ-Gao","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/zj-gao","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>